<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIÂä©ÊâãÁæ§ËÅä - ÁúüÂÆûAPIÁâàÊú¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
                sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .api-config {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .api-config h3 {
            color: #374151;
            margin-bottom: 15px;
        }

        .api-input-group {
            margin-bottom: 15px;
        }

        .api-input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #374151;
        }

        .api-input-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
        }

        .api-input-group input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .toggle-button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin-right: 10px;
        }

        .toggle-button:hover {
            background: #2563eb;
        }

        .toggle-button.active {
            background: #10b981;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 3fr;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .assistant-list {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            height: fit-content;
        }

        .assistant-list h3 {
            font-size: 1.2rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 15px;
        }

        .assistant-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            margin-bottom: 10px;
            transition: border-color 0.2s;
        }

        .assistant-item:hover {
            border-color: #d1d5db;
        }

        .assistant-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: white;
            font-weight: 600;
        }

        .assistant-info h4 {
            font-weight: 600;
            color: #374151;
            margin-bottom: 4px;
        }

        .assistant-info p {
            font-size: 0.875rem;
            color: #6b7280;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .status-dot.online {
            background: #10b981;
        }

        .status-dot.offline {
            background: #ef4444;
        }

        .chat-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            height: 600px;
            display: flex;
            flex-direction: column;
        }

        .chat-header {
            padding: 20px;
            border-bottom: 1px solid #e5e7eb;
        }

        .chat-header h2 {
            font-size: 1.2rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 4px;
        }

        .chat-header p {
            font-size: 0.875rem;
            color: #6b7280;
        }

        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .message {
            display: flex;
            align-items: flex-end;
            gap: 8px;
        }

        .message.user {
            justify-content: flex-end;
        }

        .message-content {
            max-width: 300px;
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 0.875rem;
            line-height: 1.4;
        }

        .message.user .message-content {
            background: #3b82f6;
            color: white;
            border-bottom-right-radius: 6px;
        }

        .message.assistant .message-content {
            background: white;
            color: #374151;
            border: 1px solid #e5e7eb;
            border-bottom-left-radius: 6px;
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            color: white;
            font-weight: 600;
        }

        .message-info {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 4px;
        }

        .message-name {
            font-size: 0.75rem;
            font-weight: 600;
            color: #6b7280;
        }

        .message-time {
            font-size: 0.75rem;
            color: #9ca3af;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            background: #3b82f6;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .loading {
            display: flex;
            justify-content: center;
            gap: 4px;
        }

        .loading-dot {
            width: 8px;
            height: 8px;
            background: #9ca3af;
            border-radius: 50%;
            animation: bounce 1.4s infinite ease-in-out both;
        }

        .loading-dot:nth-child(1) { animation-delay: -0.32s; }
        .loading-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        .chat-input {
            padding: 20px;
            border-top: 1px solid #e5e7eb;
        }

        .input-form {
            display: flex;
            gap: 12px;
        }

        .input-field {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 0.875rem;
            outline: none;
            transition: border-color 0.2s;
        }

        .input-field:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .send-button {
            padding: 12px 16px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .send-button:hover {
            background: #2563eb;
        }

        .send-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .send-icon {
            width: 16px;
            height: 16px;
        }

        .error-message {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #dc2626;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 15px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ AIÂä©ÊâãÁæ§ËÅä - ÁúüÂÆûAPIÁâàÊú¨</h1>
            <p>ÈÖçÁΩÆÁúüÂÆûÁöÑAI APIÂØÜÈí•Ôºå‰ΩìÈ™åÁúüÂÆûÁöÑAIÂØπËØù</p>
        </div>

        <!-- APIÈÖçÁΩÆÂå∫Âüü -->
        <div class="api-config">
            <h3>üîë APIÈÖçÁΩÆ</h3>
            <div class="api-input-group">
                <label for="deepseekApiKey">DeepSeek API Key:</label>
                <input type="password" id="deepseekApiKey" placeholder="ËæìÂÖ•‰Ω†ÁöÑDeepSeek APIÂØÜÈí•">
            </div>
            <div class="api-input-group">
                <label for="tongyiApiKey">ÈÄö‰πâÂçÉÈóÆ API Key:</label>
                <input type="password" id="tongyiApiKey" placeholder="ËæìÂÖ•‰Ω†ÁöÑÈÄö‰πâÂçÉÈóÆAPIÂØÜÈí•">
            </div>
            <div class="api-input-group">
                <label for="doubaoApiKey">Ë±ÜÂåÖ API Key:</label>
                <input type="password" id="doubaoApiKey" placeholder="ËæìÂÖ•‰Ω†ÁöÑË±ÜÂåÖAPIÂØÜÈí•">
            </div>
            
            <!-- API-only Ê®°ÂºèÔºåÂ∑≤ÁßªÈô§Ê®°Êãü/ÁúüÂÆûÂàáÊç¢ -->
            
            <div id="errorMessage" class="error-message" style="display: none;"></div>
        </div>

        <div class="main-content">
            <div class="assistant-list">
                <h3>AIÂä©ÊâãÁæ§ÁªÑ</h3>
                <div class="assistant-item">
                    <div class="assistant-avatar" style="background-color: #3B82F6;">ü§ñ</div>
                    <div class="assistant-info">
                        <h4>DeepSeek</h4>
                        <p>Âº∫Â§ßÁöÑAIÂä©ÊâãÔºåÊìÖÈïø‰ª£Á†ÅÁîüÊàêÂíåÈóÆÈ¢òËß£Á≠î</p>
                    </div>
                    <div class="status-dot" id="deepseekStatus"></div>
                </div>
                <div class="assistant-item">
                    <div class="assistant-avatar" style="background-color: #10B981;">üß†</div>
                    <div class="assistant-info">
                        <h4>ÈÄö‰πâÂçÉÈóÆ</h4>
                        <p>ÈòøÈáå‰∫ëÊô∫ËÉΩÂä©ÊâãÔºåÁü•ËØÜÊ∏äÂçöÔºåÂõûÁ≠îÂáÜÁ°Æ</p>
                    </div>
                    <div class="status-dot" id="tongyiStatus"></div>
                </div>
                        <div class="assistant-item">
            <div class="assistant-avatar" style="background-color: #FF6B35;">üçú</div>
            <div class="assistant-info">
                <h4>Ë±ÜÂåÖ</h4>
                <p>Â≠óËäÇË∑≥Âä®ÁöÑAIÂä©ÊâãÔºåÁü•ËØÜ‰∏∞ÂØåÔºåÂõûÁ≠îÂáÜÁ°Æ</p>
            </div>
            <div class="status-dot" id="doubaoStatus"></div>
        </div>
            </div>

            <div class="chat-container">
                <div class="chat-header">
                    <h2>AIÂä©ÊâãÁæ§ËÅä</h2>
                    <p id="onlineCount">3 ‰∏™AIÂä©ÊâãÂú®Á∫ø</p>
                </div>

                <div class="messages-container" id="messagesContainer">
                    <div class="message assistant">
                        <div class="message-avatar" style="background-color: #3B82F6;">ü§ñ</div>
                        <div class="message-content">
                            <div class="message-info">
                                <span class="message-name">DeepSeek</span>
                                <span class="message-time" id="time1"></span>
                            </div>
                            <p>Ê¨¢ËøéÊù•Âà∞AIÂä©ÊâãÁæ§ËÅäÔºÅÊàëÊòØDeepSeekÔºåÂæàÈ´òÂÖ¥‰∏∫‰Ω†Êèê‰æõÂ∏ÆÂä©ÔºÅ</p>
                        </div>
                    </div>
                    <div class="message assistant">
                        <div class="message-avatar" style="background-color: #10B981;">üß†</div>
                        <div class="message-content">
                            <div class="message-info">
                                <span class="message-name">ÈÄö‰πâÂçÉÈóÆ</span>
                                <span class="message-time" id="time2"></span>
                            </div>
                            <p>‰Ω†Â•ΩÔºÅÊàëÊòØÈÄö‰πâÂçÉÈóÆÔºåÊù•Ëá™ÈòøÈáå‰∫ë„ÄÇÊàëÂèØ‰ª•Â∏ÆÂä©‰Ω†Ëß£Á≠îÂêÑÁßçÈóÆÈ¢òÔºÅ</p>
                        </div>
                    </div>
                    <div class="message assistant">
                        <div class="message-avatar" style="background-color: #FF6B35;">üçú</div>
                        <div class="message-content">
                            <div class="message-info">
                                <span class="message-name">Ë±ÜÂåÖ</span>
                                <span class="message-time" id="time3"></span>
                            </div>
                            <p>‰Ω†Â•ΩÔºÅÊàëÊòØË±ÜÂåÖÔºåÊù•Ëá™Â≠óËäÇË∑≥Âä®„ÄÇÊàëÁü•ËØÜ‰∏∞ÂØåÔºåÂèØ‰ª•Â∏Æ‰Ω†Ëß£Á≠îÂêÑÁßçÈóÆÈ¢òÔºÅ</p>
                        </div>
                    </div>
                </div>

                <div class="chat-input">
                    <form class="input-form" id="chatForm">
                        <input 
                            type="text" 
                            class="input-field" 
                            id="messageInput" 
                            placeholder="ËæìÂÖ•‰Ω†ÁöÑÈóÆÈ¢ò..."
                            required
                        >
                        <button type="submit" class="send-button" id="sendButton">
                            <svg class="send-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                            </svg>
                            ÂèëÈÄÅ
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ÂÖ®Â±ÄÂèòÈáèÔºàAPI-only Ê®°ÂºèÔºâ
        let apiKeys = {
            deepseek: '',
            tongyi: '',
            doubao: ''
        };

        // ËÆæÁΩÆÂàùÂßãÊ∂àÊÅØÊó∂Èó¥
        function setInitialTimes() {
            const now = new Date();
            const time1 = document.getElementById('time1');
            const time2 = document.getElementById('time2');
            const time3 = document.getElementById('time3');
            
            time1.textContent = now.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });
            time2.textContent = now.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });
            time3.textContent = now.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });
        }

        // Â∑≤ÁßªÈô§Ê®°ÂºèÂàáÊç¢ÔºàÂõ∫ÂÆö‰∏∫ÁúüÂÆûAPIÊ®°ÂºèÔºâ

        // Êõ¥Êñ∞Áä∂ÊÄÅÊòæÁ§∫
        function updateStatus() {
            const deepseekStatus = document.getElementById('deepseekStatus');
            const tongyiStatus = document.getElementById('tongyiStatus');
            const doubaoStatus = document.getElementById('doubaoStatus');
            
            deepseekStatus.className = 'status-dot ' + (apiKeys.deepseek ? 'online' : 'offline');
            tongyiStatus.className = 'status-dot ' + (apiKeys.tongyi ? 'online' : 'offline');
            doubaoStatus.className = 'status-dot ' + (apiKeys.doubao ? 'online' : 'offline');
            
            // Êõ¥Êñ∞Âú®Á∫øÊï∞Èáè
            const onlineCount = document.getElementById('onlineCount');
            const onlineAssistants = [apiKeys.deepseek, apiKeys.tongyi, apiKeys.doubao].filter(key => key).length;
            onlineCount.textContent = `${onlineAssistants} ‰∏™AIÂä©ÊâãÂú®Á∫ø`;
        }

        // ‰øùÂ≠òAPIÂØÜÈí•
        function saveApiKeys() {
            apiKeys.deepseek = document.getElementById('deepseekApiKey').value;
            apiKeys.tongyi = document.getElementById('tongyiApiKey').value;
            apiKeys.doubao = document.getElementById('doubaoApiKey').value;
            
            // ‰øùÂ≠òÂà∞Êú¨Âú∞Â≠òÂÇ®
            localStorage.setItem('aiChatApiKeys', JSON.stringify(apiKeys));
            
            updateStatus();
        }

        // Âä†ËΩΩ‰øùÂ≠òÁöÑÈÖçÁΩÆ
        function loadSavedConfig() {
            const savedKeys = localStorage.getItem('aiChatApiKeys');
            
            if (savedKeys) {
                apiKeys = JSON.parse(savedKeys);
                document.getElementById('deepseekApiKey').value = apiKeys.deepseek;
                document.getElementById('tongyiApiKey').value = apiKeys.tongyi;
                document.getElementById('doubaoApiKey').value = apiKeys.doubao;
            }
            
            updateStatus();
        }

        // ÊòæÁ§∫ÈîôËØØ‰ø°ÊÅØ
        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }

        // AIÂä©ÊâãÈÖçÁΩÆÔºàAPI-onlyÔºâ
        const assistants = [
            { id: 'deepseek', name: 'DeepSeek', avatar: 'ü§ñ', color: '#3B82F6' },
            { id: 'tongyi', name: 'ÈÄö‰πâÂçÉÈóÆ', avatar: 'üß†', color: '#10B981' },
            { id: 'doubao', name: 'Ë±ÜÂåÖ', avatar: 'üçú', color: '#FF6B35' }
        ];

        // Â∑≤ÁßªÈô§Ê®°ÊãüAIÊ®°Âùó

        // Ë∞ÉÁî®ÁúüÂÆûAPI
        async function callRealAPI(userMessage, assistantId) {
            // ËøôÈáåÈúÄË¶ÅÊ†πÊçÆÂÆûÈôÖÁöÑAPIÊñáÊ°£Êù•ÂÆûÁé∞
            // ‰ª•‰∏ãÊòØÁ§∫‰æã‰ª£Á†ÅÔºå‰Ω†ÈúÄË¶ÅÊ†πÊçÆÂÆûÈôÖÊÉÖÂÜµ‰øÆÊîπ
            
            try {
                switch(assistantId) {
                    case 'deepseek':
                        if (!apiKeys.deepseek) {
                            throw new Error('DeepSeek APIÂØÜÈí•Êú™ÈÖçÁΩÆ');
                        }
                        // Ë∞ÉÁî®DeepSeek API
                        return await callDeepSeekAPI(userMessage, apiKeys.deepseek);
                        
                    case 'tongyi':
                        if (!apiKeys.tongyi) {
                            throw new Error('ÈÄö‰πâÂçÉÈóÆAPIÂØÜÈí•Êú™ÈÖçÁΩÆ');
                        }
                        // Ë∞ÉÁî®ÈÄö‰πâÂçÉÈóÆAPI
                        return await callTongyiAPI(userMessage, apiKeys.tongyi);
                        
                    case 'doubao':
                        if (!apiKeys.doubao) {
                            throw new Error('Ë±ÜÂåÖAPIÂØÜÈí•Êú™ÈÖçÁΩÆ');
                        }
                        // Ë∞ÉÁî®Ë±ÜÂåÖAPI
                        return await calldoubaoAPI(userMessage, apiKeys.doubao);
                        
                    default:
                        throw new Error('Êú™Áü•ÁöÑAIÂä©Êâã');
                }
            } catch (error) {
                console.error(`Ë∞ÉÁî®${assistantId} APIÂ§±Ë¥•:`, error);
                return `Êä±Ê≠âÔºåË∞ÉÁî®${assistantId} APIÊó∂Âá∫Áé∞ÈîôËØØ: ${error.message}`;
            }
        }

        // Á§∫‰æãAPIË∞ÉÁî®ÂáΩÊï∞ÔºàÈúÄË¶ÅÊ†πÊçÆÂÆûÈôÖAPIÊñáÊ°£‰øÆÊîπÔºâ
        async function callDeepSeekAPI(message, apiKey) {
            // ËøôÈáåÈúÄË¶ÅÊ†πÊçÆDeepSeekÁöÑÂÆûÈôÖAPIÊñáÊ°£Êù•ÂÆûÁé∞
            // Á§∫‰æãÔºö
            const response = await fetch('https://api.deepseek.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${apiKey}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    model: 'deepseek-chat',
                    messages: [{ role: 'user', content: message }]
                })
            });
            
            if (!response.ok) {
                throw new Error(`APIË∞ÉÁî®Â§±Ë¥•: ${response.status}`);
            }
            
            const data = await response.json();
            return data.choices[0].message.content;
        }

        async function callTongyiAPI(message, apiKey) {
            // DashScope ÂÖºÂÆπÊ®°ÂºèÔºàOpenAI È£éÊ†ºÔºâ
            const response = await fetch('https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${apiKey}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    model: 'qwen-plus',
                    messages: [{ role: 'user', content: message }]
                })
            });
            
            if (!response.ok) {
                const errorText = await response.text();
                throw new Error(`APIË∞ÉÁî®Â§±Ë¥•: ${response.status} - ${errorText}`);
            }
            
            const data = await response.json();
            const content = data?.choices?.[0]?.message?.content;
            if (content) return content;
            throw new Error('APIÂìçÂ∫îÊ†ºÂºè‰∏çÊ≠£Á°Æ');
        }

        async function calldoubaoAPI(message, apiKey) {
            // Ë±ÜÂåÖAPIË∞ÉÁî® - Â∞ùËØïÂ§ö‰∏™ÂèØËÉΩÁöÑÊ®°ÂûãÂêçÁß∞
            const possibleModels = [
                "doubao-seed-1-6-250615",
            ];
            
            for (const model of possibleModels) {
                try {
                    console.log(`Â∞ùËØïË±ÜÂåÖÊ®°Âûã: ${model}`);
                    
                    const response = await fetch('https://ark.cn-beijing.volces.com/api/v3/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${apiKey}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            model: model,
                            messages: [{ role: 'user', content: message }],
                            max_tokens: 1000,
                            temperature: 0.7
                        })
                    });
                    
                    if (!response.ok) {
                        const errorText = await response.text();
                        console.log(`Ê®°Âûã ${model} Â§±Ë¥•: ${response.status} - ${errorText}`);
                        continue; // Â∞ùËØï‰∏ã‰∏Ä‰∏™Ê®°Âûã
                    }
                    
                    const data = await response.json();
                    console.log(`Ê®°Âûã ${model} ÊàêÂäü!`);
                    
                    // Ê†πÊçÆË±ÜÂåÖAPIÁöÑÂìçÂ∫îÊ†ºÂºèËß£Êûê
                    if (data.choices && data.choices[0] && data.choices[0].message) {
                        return data.choices[0].message.content;
                    } else if (data.output && data.output.text) {
                        return data.output.text;
                    } else {
                        throw new Error('APIÂìçÂ∫îÊ†ºÂºè‰∏çÊ≠£Á°Æ');
                    }
                } catch (error) {
                    console.log(`Ê®°Âûã ${model} Âá∫Èîô:`, error.message);
                    continue; // Â∞ùËØï‰∏ã‰∏Ä‰∏™Ê®°Âûã
                }
            }
            
            // ÊâÄÊúâÊ®°ÂûãÈÉΩÂ§±Ë¥•‰∫Ü
            throw new Error('ÊâÄÊúâË±ÜÂåÖÊ®°ÂûãÈÉΩÊó†Ê≥ïËÆøÈóÆÔºåËØ∑Ê£ÄÊü•APIÂØÜÈí•ÂíåÊùÉÈôê');
        }

        // Ê∑ªÂä†Ê∂àÊÅØÂà∞ËÅäÂ§©ÁïåÈù¢
        function addMessage(content, sender, assistantId = null) {
            const messagesContainer = document.getElementById('messagesContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            if (sender === 'user') {
                messageDiv.innerHTML = `
                    <div class="message-content">
                        <p>${content}</p>
                    </div>
                    <div class="user-avatar">Êàë</div>
                `;
            } else {
                const assistant = assistants.find(a => a.id === assistantId);
                messageDiv.innerHTML = `
                    <div class="message-avatar" style="background-color: ${assistant.color};">${assistant.avatar}</div>
                    <div class="message-content">
                        <div class="message-info">
                            <span class="message-name">${assistant.name}</span>
                            <span class="message-time">${new Date().toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' })}</span>
                        </div>
                        <p>${content}</p>
                    </div>
                `;
            }
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
        function showLoading() {
            const messagesContainer = document.getElementById('messagesContainer');
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'loading';
            loadingDiv.id = 'loading';
            loadingDiv.innerHTML = `
                <div class="loading-dot"></div>
                <div class="loading-dot"></div>
                <div class="loading-dot"></div>
            `;
            messagesContainer.appendChild(loadingDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // ÈöêËóèÂä†ËΩΩÁä∂ÊÄÅ
        function hideLoading() {
            const loading = document.getElementById('loading');
            if (loading) {
                loading.remove();
            }
        }

        // Â§ÑÁêÜË°®ÂçïÊèê‰∫§
        document.getElementById('chatForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Ê∑ªÂä†Áî®Êà∑Ê∂àÊÅØ
            addMessage(message, 'user');
            input.value = '';
            
            // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
            showLoading();
            
            try {
                const responses = await Promise.all(
                    assistants.map(async (assistant) => {
                        try {
                            const response = await callRealAPI(message, assistant.id);
                            return { assistant, response, success: true };
                        } catch (error) {
                            return { assistant, response: error.message, success: false };
                        }
                    })
                );
                
                hideLoading();
                
                responses.forEach(({ assistant, response, success }) => {
                    if (success) {
                        addMessage(response, 'assistant', assistant.id);
                    } else {
                        addMessage(`ÈîôËØØ: ${response}`, 'assistant', assistant.id);
                    }
                });
            } catch (error) {
                hideLoading();
                showError(`ÂèëÈÄÅÊ∂àÊÅØÂ§±Ë¥•: ${error.message}`);
            }
        });

        // ÁõëÂê¨APIÂØÜÈí•ËæìÂÖ•ÂèòÂåñ
        document.getElementById('deepseekApiKey').addEventListener('input', saveApiKeys);
        document.getElementById('tongyiApiKey').addEventListener('input', saveApiKeys);
        document.getElementById('doubaoApiKey').addEventListener('input', saveApiKeys);

        // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            setInitialTimes();
            loadSavedConfig();
        });
    </script>
</body>
</html> 